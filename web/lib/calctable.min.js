var vea={basketOffers:{},props:{},initBasketTable:function(e){if("object"==typeof e.buttonDelete||"array"==typeof e.buttonDelete)var t=e.buttonDelete.length;else var t=1;if(e=this.testParams(e,{row:"r",price:".price",count:'.count input[type="text"]',exeption:"j",checkbox:!1,buttonPlus:!1,buttonMines:!1,itemsNames:{1:"товар",24:"товара",5:"товаров"},buttonDelete:"j",deleteRowByNotClass:"qwfqwfqgqwgihje",deleteSpeed:500,deleteDelay:500,rowSum:!1,basketSum:"requiredParam",basketCount:!1,sumWithoutZero:!1},"initBasketTable"),!e)return!1;this.basketOffers[e.row]={};var r=this.basketOffers[e.row],a=0,s=function(e,t){var s=0,n=0,i=$(t.rowSum);i.size()<1&&vea.d("Not found elem for sum item: "+t.rowSum);for(var u=0;a>u;u++)n+=parseInt(r[u].count),s+=r[u].sum,i&&$(i[u]).html(o(r[u].sum,1,t.sumWithoutZero));s=o(s,1,t.sumWithoutZero),n=o(n,1,!0),$(t.basketSum).size()<1?vea.d("Not found elem for sum basket: "+t.basketSum):$(t.basketSum).html(s),$(t.basketCount).size()<1?vea.d("Not found elem for count all items of basket: "+t.basketCount):$(t.basketCount).html(n),"function"==typeof t.afterCalculate&&t.afterCalculate()},o=function(e,t,r){var a=e*t;if(a+="",-1!=a.indexOf(".")){var s=a.substr(a.indexOf("."));s="0"+s,s=1*s,s=s.toFixed(2),s+="",s=s.replace("0",""),a=a.substr(0,a.indexOf("."))}var o=a.split("").reverse().join("");return o=o.replace(/([0-9]{3})/g,"$1#").split("").reverse().join(""),o=o.replace(/#/g,"&nbsp;"),s?(o+=s,o=o.replace(".",",&nbsp;")):1==r?o:2==r?o+",<small>00</small> ":o+",&nbsp;00"};this.d("paramsBasket",e),$(document).ready(function(){var o=$(e.exeptions);o.size()<=0&&(o=!1);for(var n=$(e.price),i=$(e.count),u=$(e.buttonPlus),c=$(e.buttonMines),f=$(e.buttonDelete),l=0;l<n.size();l++){var d=vea.formatStringToNumeric($(n[l]).html()),p=vea.formatStringToNumeric($(i[l]).val());if(r[a]={price:d,count:p,sum:d*p},$(i[l]).keyup(function(t){return function(){if(r[t].count=0|parseInt($(this).val()),e.checkbox)var a=$(e.checkbox)[t];"undefined"!=typeof a&&($(a).prop("checked")||(r[t].count=0)),r[t].sum=r[t].count*r[t].price,s(!1,e)}}(a)),e.checkbox){var m=$(e.checkbox)[l];"undefined"!=typeof m&&($(m).prop("checked")||(r[a].count=0,r[a].sum=0),$(m).change(function(t){return function(){r[t].count=$(this).prop("checked")?$(e.count)[t].val():0,r[t].sum=r[t].count*r[t].price,s(!1,e)}}(a)))}(e.buttonPlus||e.buttonMines)&&("undefined"!=typeof u[l]||"undefined"!=typeof c[l])&&(changeOffersFromButton=function(t,r,a){var o=$(e.count)[r],n=$(o).val();return a?n++:n--,0>n&&(n=0),$(o).val(n),t[r].count=n,t[r].sum=t[r].count*t[r].price,s(!1,e),!1},$(c[l]).click(function(e){return function(){changeOffersFromButton(r,e,!1)}}(a,c)),$(u[l]).click(function(e){return function(){changeOffersFromButton(r,e,!0)}}(a,c)));for(var h=l*t;h<t*l+parseInt(t);h++)f[h]&&(vea.d("event listern",$(f[h]),a),$(f[h]).click(function(t){return function(){e.deleteRowByNotClass,"Вы действительно хотите удалить "+e.itemsNames[1]+"?";return vea.d("indexOffers",t),$($(e.count)[t]).val(0),r[t].count=0,r[t].sum=0,setTimeout(function(){$($(e.row)[t]).animate({opacity:0},e.deleteSpeed,function(){$(this).slideUp(0)})},e.deleteDelay),s(!1,e),!1}}(a)));a++}s(!0,e)})},d:function(){if(!this.debugMode)return!1;if("undefined"!=typeof console.log)for(var e=0;e<arguments.length;e++)console.log(arguments[e])},testParams:function(e,t,r){if("undefined"==typeof r?r="!":"string"==typeof r&&(r=" in vea."+r+"!"),"undefined"==typeof e)return this.d("Not get params"+r);if("undefined"==typeof t&&this.d("Not get defaultParams"+r),"array"==typeof t)for(var a=0;a<t.length;a++)e[t[a]]||(e[t[a]]=!1);else if("object"==typeof t)for(var s in t){if("string"==typeof e){var o=e;e={},e[s]=o,this.d("Was got string type of params, which was remake in object  "+r);break}switch(t[s]){case"r":case"rj":if("undefined"==typeof e[s])return this.d("Not get "+s+" parameter"+r);case"j":"undefined"==typeof e[s]?e[s]=!1:("array"==typeof e[s]||"object"==typeof e[s])&&(e[s]=e[s].join(", "));break;default:"undefined"==typeof e[s]&&(e[s]=t[s])}}return e},formatStringToNumeric:function(e){-1!=e.indexOf(",")&&(e=e.replace(",","."));var t=/[^0-9|\-|\.]/g;return 1*e.replace(t,"")},validateEmail:function(e){var t,r=e.indexOf("@"),a=e.substr(r+1),s=e.substr(0,r),o=s.length,n=a.length,i=!0;return 1>o||o>64?(i=!1,t="local part length exceeded"):1>n||n>255?(t="domain part length exceeded",i=!1):"."==s.substr(0,1)||"."==s.substr(o-1)?(t="local part starts or ends with '.'",i=!1):"."==a.substr(0,1)||"."==a.substr(n-1)?(t="Domain part starts or ends with '.'",i=!1):/\\.\\./.exec(s)?(t="local part has two consecutive dots",i=!1):/^[A-Za-z0-9\\-\\.]+/.exec(a)?/\\.\\./.exec(a)?(t="domain part has two consecutive dots",i=!1):/^(\\\\.|[A-Za-z0-9!#%&`_=\\/\'*+?^{}|~.-])+/.exec(s.replace("\\\\",""))||(t="character not valid in local part unless local part is quoted",/^"(\\\\"|[^"])+"/.exec(s.replace("\\\\",""))||(i=!1)):(t="character not valid in domain part",i=!1),t&&vea.d("Email not valid! "+t),i},validateForm:function(e){if(e=this.testParams(e,{form:"form",required:".required",password:"input[type=password]",passLength:6,passValue:/a-zA-Z0-9\.\,\?\!\*\#\$\%\^\&\*\-\_\+\=/,passNeed:!0,submit:"input[type=submit]",errorForm:"error",errorInput:"error",startValidate:function(){$(e.form+" "+e.submit).attr("disabled",!0)},successValidate:function(){$(e.form+" "+e.submit).attr("disabled",!1)},noticeFunc:!1}),!e)return this.d("Fail call validate function!");var t,r,a;$(document).ready(function(){if(t=$(e.form),r=t.find(e.required),e.passNeed&&(a=t.find(e.password)),r.size()<1&&t.find(e.password).size()<2)return vea.d("Form don`t need validate!");e.startValidate(),vea.props[e.form]||(vea.props[e.form]={}),vea.props[e.form].requiredCount=r.size(),vea.props[e.form].elems={};var s=function(){var r=$(this).attr("type"),s=-1;switch(this.tagName.toLowerCase()){case"input":("checkbox"==r||"radio"==r)&&(s=$(this).attr("checked")?!0:!1);case"select":case"textarea":var o=!0,n=1;-1==s&&("email"==$(this).attr("type")||void 0!=$(this).attr("placeholder")&&-1!=$(this).attr("placeholder").toLowerCase().indexOf("mail"))&&(o=vea.validateEmail($(this).val())),"password"==r&&(n=e.passLength);var i=this.name;if(i||(i=this.id?this.id:this.id="_vea.validateform"+Math.random()),s===!0||""!=$(this).val().replace(/^\s+|\s+$/,"")&&o&&-1==s&&$(this).val().length>n-1){if("string"==typeof e.errorInput)$(this).removeClass(e.errorInput);else if("function"==typeof e.errorInput)var u=e.errorInput(this,!1);console.log(u),vea.props[e.form].elems[i]=u===!1?0:1}else{if("string"==typeof e.errorInput)$(this).addClass(e.errorInput);else if("function"==typeof e.errorInput)var u=e.errorInput(this,!0);vea.props[e.form].elems[i]=u===!1?1:0}}var c=vea.props[e.form].elems,f=0,l="";for(var d in c)f+=parseInt(c[d]);if(f==vea.props[e.form].requiredCount){if(e.passNeed&&e.passLength){var p=$(a[0]).val();if(2==a.size()&&p==$(a[1]).val()||1==a.size()||!e.password||a.size()<1){if(!(a.size()>0))return e.successValidate();if(p.length>=e.passLength){if(!e.passNeed)return e.successValidate();if("string"==typeof e.passNeed||e.passNeed instanceof RegExp){if(-1!=p.search(e.passNeed))return e.successValidate();l="specCharsPass"}else if("function"==typeof e.passNeed&&e.passNeed(p))return e.successValidate()}else l="smallPass"}else l="diferentPass"}if(!l)return void e.successValidate(t.get(0))}"function"==typeof e.errorForm?e.errorForm(t.get(0),l):t.addClass(e.errorForm)};$(r).keyup(s),$(r).blur(s),$(r).each(function(){("checkbox"==$(this).attr("type")||"radio"==$(this).attr("type"))&&$(this).change(s)})})}};